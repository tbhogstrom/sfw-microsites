---
/**
 * ServiceContent Component
 * Displays all the content sections from a service page
 */
import type { ServicePageData } from '../data/services';
import { marked } from 'marked';

interface Props {
  service: ServicePageData;
}

const { service } = Astro.props;

/**
 * Convert markdown to HTML
 */
function markdownToHtml(markdown: string): string {
  return marked.parse(markdown) as string;
}

/**
 * Extract process steps from markdown
 */
function extractProcessSteps(content: string): Array<{ title: string; description: string }> {
  const steps: Array<{ title: string; description: string }> = [];
  const stepMatches = content.matchAll(/\d+\.\s+\*\*([^*]+)\*\*\s*\n\s*(.+?)(?=\n\d+\.\s+\*\*|\n##|$)/gs);

  for (const match of stepMatches) {
    steps.push({
      title: match[1].trim(),
      description: match[2].trim(),
    });
  }

  return steps;
}

const processSteps = service.sections.process
  ? extractProcessSteps(service.sections.process.content)
  : [];
---

<!-- Service Overview Section -->
{service.sections.overview && (
  <section id="overview" class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.overview.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700 prose-a:text-primary prose-a:no-underline hover:prose-a:underline"
          set:html={markdownToHtml(service.sections.overview.content)}
        />
      </div>
    </div>
  </section>
)}

<!-- Process Section -->
{service.sections.process && processSteps.length > 0 && (
  <section class="py-16 bg-gray-light">
    <div class="container mx-auto px-4">
      <div class="max-w-5xl mx-auto">
        <h2 class="text-4xl font-heading font-bold text-center mb-12">
          Our Process
        </h2>

        <div class="space-y-8">
          {processSteps.map((step, index) => (
            <div class="flex gap-6 items-start">
              <!-- Step Number -->
              <div class="flex-shrink-0 w-12 h-12 bg-primary text-white rounded-full flex items-center justify-center font-bold text-xl">
                {index + 1}
              </div>

              <!-- Step Content -->
              <div class="flex-1 bg-white p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-heading font-bold mb-3 text-dark">
                  {step.title}
                </h3>
                <div
                  class="prose prose-gray max-w-none prose-p:text-gray-700"
                  set:html={markdownToHtml(step.description)}
                />
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>
)}

<!-- Why Choose Us Section -->
{service.sections.whyChooseUs && (
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.whyChooseUs.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700 prose-ul:space-y-3"
          set:html={markdownToHtml(service.sections.whyChooseUs.content)}
        />
      </div>
    </div>
  </section>
)}

<!-- Service Areas Section -->
{service.sections.serviceAreas && (
  <section class="py-16 bg-gray-light">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.serviceAreas.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700"
          set:html={markdownToHtml(service.sections.serviceAreas.content)}
        />
      </div>
    </div>
  </section>
)}

<!-- Pricing & Estimates Section -->
{service.sections.pricing && (
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.pricing.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700 prose-ul:space-y-3"
          set:html={markdownToHtml(service.sections.pricing.content)}
        />

        <!-- Free Estimate CTA -->
        <div class="mt-8 bg-primary-light border-l-4 border-primary p-6 rounded-r-lg">
          <h3 class="text-xl font-heading font-bold mb-2">Get Your Free Estimate Today</h3>
          <p class="text-gray-700 mb-4">
            We offer free, no-obligation estimates for all {service.name.toLowerCase()} projects in {service.locationFull}.
          </p>
          <a
            href="tel:{serviceConfigs['deck-repair'].phone}"
            class="inline-flex items-center px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-colors"
          >
            Call for Free Estimate
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>
)}

<!-- Local Considerations Section -->
{service.sections.localConsiderations && (
  <section class="py-16 bg-gray-light">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.localConsiderations.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700"
          set:html={markdownToHtml(service.sections.localConsiderations.content)}
        />
      </div>
    </div>
  </section>
)}

<!-- Technical Details Section -->
{service.sections.technicalDetails && (
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-heading font-bold mb-8">
          {service.sections.technicalDetails.title}
        </h2>
        <div
          class="prose prose-lg max-w-none prose-headings:font-heading prose-headings:text-dark prose-p:text-gray-700 prose-li:text-gray-700 prose-ul:space-y-2"
          set:html={markdownToHtml(service.sections.technicalDetails.content)}
        />
      </div>
    </div>
  </section>
)}

<style>
  /* Enhance prose styling */
  :global(.prose h3) {
    @apply text-2xl mt-8 mb-4;
  }

  :global(.prose h4) {
    @apply text-xl mt-6 mb-3;
  }

  :global(.prose ul) {
    @apply space-y-2;
  }

  :global(.prose ol) {
    @apply space-y-2;
  }

  :global(.prose li) {
    @apply leading-relaxed;
  }

  :global(.prose strong) {
    @apply text-dark font-semibold;
  }

  /* Remove default list markers for better custom styling */
  :global(.prose ul > li) {
    @apply pl-1;
  }
</style>
