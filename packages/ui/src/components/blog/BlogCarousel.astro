---
/**
 * BlogCarousel.astro - Swiper.js carousel for blog posts
 * Responsive slider with navigation and pagination
 */
import type { BaseProps, BlogPost } from '@sfw/ui/types';
import BlogCard from './BlogCard.astro';

export interface Props extends BaseProps {
  posts: BlogPost[];
  title?: string;
  autoplay?: boolean;
  autoplayDelay?: number;
}

const {
  posts,
  title,
  autoplay = false,
  autoplayDelay = 5000,
  class: className = '',
  ...rest
} = Astro.props;

const classes = ['py-12', className].filter(Boolean).join(' ');
const sliderId = `blog-slider-${Math.random().toString(36).substr(2, 9)}`;
---

<section class={classes} {...rest}>
  <div class="container mx-auto px-4">
    {title && (
      <h2 class="text-3xl md:text-4xl font-heading font-bold text-center mb-12">
        {title}
      </h2>
    )}

    <!-- Swiper Container -->
    <div class="relative max-w-6xl mx-auto">
      <div class={`swiper ${sliderId}`}>
        <div class="swiper-wrapper">
          {posts.map((post) => (
            <div class="swiper-slide">
              <BlogCard post={post} />
            </div>
          ))}
        </div>

        <!-- Navigation Buttons -->
        <div class={`swiper-button-prev swiper-button-prev-${sliderId}`}></div>
        <div class={`swiper-button-next swiper-button-next-${sliderId}`}></div>
      </div>
    </div>
  </div>
</section>

<script define:vars={{ sliderId, autoplay, autoplayDelay }}>
  // Dynamically import Swiper to avoid SSR issues
  import('swiper/css').then(() => {
    import('swiper/css/navigation').then(() => {
      import('swiper').then(({ default: Swiper, Navigation, Autoplay }) => {
        new Swiper(`.${sliderId}`, {
          modules: [Navigation, Autoplay],
          slidesPerView: 1,
          spaceBetween: 20,
          autoplay: autoplay ? {
            delay: autoplayDelay,
            disableOnInteraction: false,
          } : false,
          navigation: {
            nextEl: `.swiper-button-next-${sliderId}`,
            prevEl: `.swiper-button-prev-${sliderId}`,
          },
          breakpoints: {
            640: {
              slidesPerView: 2,
              spaceBetween: 20,
            },
            1024: {
              slidesPerView: 3,
              spaceBetween: 30,
            },
          },
        });
      });
    });
  });
</script>

<style>
  /* Custom Swiper Styles */
  :global(.swiper-button-prev),
  :global(.swiper-button-next) {
    color: var(--primary-color, #a1b770);
  }

  :global(.swiper-button-prev:after),
  :global(.swiper-button-next:after) {
    font-size: 24px;
  }

  @media (max-width: 1023px) {
    :global(.swiper-button-prev),
    :global(.swiper-button-next) {
      display: none;
    }
  }

  /* Ensure swiper slides display horizontally */
  :global(.swiper-wrapper) {
    display: flex;
    flex-direction: row;
  }
</style>
